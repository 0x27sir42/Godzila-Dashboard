<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ZILA – Claim Rewards</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="css/style.css">
<script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.min.js"></script>
</head>

<body>

<!-- NAVBAR -->
<div class="navbar">
  <a href="index.html">Home</a>
  <a href="presale.html">Presale</a>
  <a href="staking.html">Staking</a>
  <a href="claim.html">Claim</a>
  <a href="tokenomics.html">Tokenomics</a>
  <a href="whitepaper.html">Whitepaper</a>

  <button id="connectBtn">Connect Wallet</button>
</div>

<!-- CONTENT -->
<div class="container">
  <div class="card">
    <h2>Claim Rewards</h2>

    <p id="walletText">Wallet: Not connected</p>

    <button id="claimBtn">Claim Rewards</button>

    <hr>

    <h3>How to Claim</h3>
    <p>1. Connect wallet</p>
    <p>2. Ensure POL balance for gas</p>
    <p>3. Click Claim Rewards</p>
    <p>4. Confirm transaction in MetaMask</p>

    <hr>

    <h3>History</h3>
    <ul id="history"></ul>
  </div>
</div>

<script>
/* ==============================
   CONFIG
================================ */
const STAKING_CONTRACT = "0x69862631A0E37dDCc22F3ba5153ca12BB0934B43";

/* ==============================
   STATE
================================ */
let provider;
let signer;
let userAddress = null;

/* ==============================
   CONNECT WALLET
================================ */
document.getElementById("connectBtn").onclick = async () => {
  if (!window.ethereum) {
    alert("MetaMask not detected");
    return;
  }

  try {
    provider = new ethers.providers.Web3Provider(window.ethereum);
    await provider.send("eth_requestAccounts", []);
    signer = provider.getSigner();
    userAddress = await signer.getAddress();

    document.getElementById("connectBtn").innerText =
      userAddress.slice(0,6) + "..." + userAddress.slice(-4);

    document.getElementById("walletText").innerText =
      "Wallet: " + userAddress;

  } catch (err) {
    alert("Wallet connection failed");
    console.error(err);
  }
};

/* ==============================
   CLAIM REWARD
================================ */
document.getElementById("claimBtn").onclick = async () => {
  if (!userAddress) {
    alert("Connect wallet first");
    return;
  }

  try {
    const staking = new ethers.Contract(
      STAKING_CONTRACT,
      ["function claim() public"],
      signer
    );

    const tx = await staking.claim();
    addHistory("Claim submitted: " + tx.hash);

    await tx.wait();
    addHistory("Claim success");

  } catch (err) {
    alert("Claim failed");
    console.error(err);
  }
};

/* ==============================
   HISTORY
================================ */
function addHistory(text) {
  const li = document.createElement("li");
  li.innerText = new Date().toLocaleString() + " — " + text;
  document.getElementById("history").prepend(li);
}
</script>

</body>
</html>
